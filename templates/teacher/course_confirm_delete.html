{% extends 'base.html' %}
{% block title %}Delete {{ course.title }}{% endblock %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">
        <!-- Warning Card -->
        <div class="card border-0 shadow-lg">
            <div class="card-header bg-danger text-white text-center py-4">
                <i class="bi bi-exclamation-triangle display-3 mb-3"></i>
                <h3 class="mb-0 fw-bold">Delete Course</h3>
                <p class="mb-0 opacity-90">This action cannot be undone</p>
            </div>
            <div class="card-body p-5">
                <!-- Course Info -->
                <div class="alert alert-light border-start border-4 border-warning mb-4">
                    <div class="d-flex align-items-start">
                        <i class="bi bi-info-circle text-warning me-3 mt-1"></i>
                        <div>
                            <h6 class="fw-bold mb-2">Course to Delete:</h6>
                            <h5 class="text-dark mb-2">{{ course.title }}</h5>
                            <div class="row g-2 small">
                                <div class="col-6">
                                    <span class="text-muted">Price:</span> 
                                    <span class="fw-semibold">${{ course.price }}</span>
                                </div>
                                <div class="col-6">
                                    <span class="text-muted">Students:</span> 
                                    <span class="fw-semibold">{{ course.enrolled_students.count }}</span>
                                </div>
                                <div class="col-6">
                                    <span class="text-muted">Content:</span> 
                                    <span class="fw-semibold">{{ course.content_set.count }} items</span>
                                </div>
                                <div class="col-6">
                                    <span class="text-muted">Created:</span> 
                                    <span class="fw-semibold">{{ course.created_at|date:"M Y" }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Warning Message -->
                <div class="bg-danger bg-opacity-10 border border-danger border-opacity-25 rounded p-4 mb-4">
                    <h6 class="text-danger fw-bold mb-3">
                        <i class="bi bi-exclamation-triangle me-2"></i>Warning: Permanent Deletion
                    </h6>
                    <p class="text-danger mb-3">
                        Deleting this course will permanently remove:
                    </p>
                    <ul class="text-danger mb-0">
                        <li>All course content and materials</li>
                        <li>Student enrollment records</li>
                        <li>Course statistics and analytics</li>
                        <li>Associated files and resources</li>
                        <li>All progress tracking data</li>
                    </ul>
                </div>
                
                {% if course.enrolled_students.count > 0 %}
                    <div class="alert alert-warning d-flex align-items-center mb-4">
                        <i class="bi bi-people me-2"></i>
                        <div>
                            <strong>{{ course.enrolled_students.count }} student{{ course.enrolled_students.count|pluralize }}</strong> 
                            {{ course.enrolled_students.count|pluralize:"is,are" }} currently enrolled in this course.
                            They will lose access immediately after deletion.
                        </div>
                    </div>
                {% endif %}
                
                <!-- Confirmation Form -->
                <form method="post" class="needs-validation" novalidate>
                    {% csrf_token %}
                    <div class="mb-4">
                        <label for="confirmTitle" class="form-label fw-semibold text-danger">
                            <i class="bi bi-shield-exclamation me-2"></i>
                            Type the course title to confirm deletion:
                        </label>
                        <input type="text" 
                               class="form-control form-control-lg" 
                               id="confirmTitle" 
                               placeholder="{{ course.title }}" 
                               required>
                        <div class="form-text text-muted">
                            <i class="bi bi-info-circle me-1"></i>
                            This helps prevent accidental deletions
                        </div>
                        <div class="invalid-feedback">
                            Course title must match exactly to proceed with deletion.
                        </div>
                    </div>
                    
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" id="confirmUnderstand" required>
                        <label class="form-check-label fw-semibold text-danger" for="confirmUnderstand">
                            I understand this action cannot be undone
                        </label>
                        <div class="invalid-feedback">
                            You must confirm you understand this action is permanent.
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-flex gap-3 justify-content-end pt-3 border-top">
                        <a href="{% url 'teacher_dashboard' %}" class="btn btn-outline-secondary btn-lg px-4">
                            <i class="bi bi-x-circle me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-danger btn-lg px-4" id="deleteBtn" disabled>
                            <i class="bi bi-trash me-2"></i>Delete Course
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Safety Tips Card -->
        <div class="card border-0 bg-light mt-4">
            <div class="card-body p-4">
                <h6 class="fw-bold mb-3">
                    <i class="bi bi-lightbulb text-primary me-2"></i>Alternative Options
                </h6>
                <div class="row g-3">
                    <div class="col-12">
                        <div class="d-flex align-items-start">
                            <i class="bi bi-eye-slash text-muted me-3 mt-1"></i>
                            <div>
                                <small class="fw-semibold">Archive Instead:</small>
                                <small class="d-block text-muted">Consider hiding the course from students instead of permanent deletion</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="d-flex align-items-start">
                            <i class="bi bi-download text-muted me-3 mt-1"></i>
                            <div>
                                <small class="fw-semibold">Backup First:</small>
                                <small class="d-block text-muted">Download course content and student data before deletion</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="d-flex align-items-start">
                            <i class="bi bi-envelope text-muted me-3 mt-1"></i>
                            <div>
                                <small class="fw-semibold">Notify Students:</small>
                                <small class="d-block text-muted">Inform enrolled students about course discontinuation</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    border-radius: 15px;
}

.form-control:focus {
    border-color: #dc3545;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

.alert {
    border-radius: 10px;
}

#deleteBtn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmTitle = document.getElementById('confirmTitle');
    const confirmUnderstand = document.getElementById('confirmUnderstand');
    const deleteBtn = document.getElementById('deleteBtn');
    const expectedTitle = "{{ course.title }}";
    
    function validateForm() {
        const titleMatch = confirmTitle.value === expectedTitle;
        const checkboxChecked = confirmUnderstand.checked;
        
        if (titleMatch && checkboxChecked) {
            deleteBtn.disabled = false;
            deleteBtn.classList.remove('btn-outline-danger');
            deleteBtn.classList.add('btn-danger');
        } else {
            deleteBtn.disabled = true;
            deleteBtn.classList.add('btn-outline-danger');
            deleteBtn.classList.remove('btn-danger');
        }
        
        // Visual feedback for title input
        if (confirmTitle.value.length > 0) {
            if (titleMatch) {
                confirmTitle.classList.remove('is-invalid');
                confirmTitle.classList.add('is-valid');
            } else {
                confirmTitle.classList.remove('is-valid');
                confirmTitle.classList.add('is-invalid');
            }
        } else {
            confirmTitle.classList.remove('is-valid', 'is-invalid');
        }
    }
    
    confirmTitle.addEventListener('input', validateForm);
    confirmUnderstand.addEventListener('change', validateForm);
    
    // Final confirmation before submission
    document.querySelector('form').addEventListener('submit', function(e) {
        if (!confirm('Are you absolutely sure you want to delete this course? This action cannot be undone.')) {
            e.preventDefault();
        }
    });
});
</script>
{% endblock %}